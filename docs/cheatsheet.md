# Шпаргалка по имитационному моделированию

Все ключевые определения, формулы и справочные материалы курса в одном месте.

---

## Краткое резюме по темам

### 1. Введение в ИМ
Имитационная модель --- исполняемая модель системы, воспроизводящая её поведение во времени. Три подхода --- системная динамика, агентное моделирование и дискретно-событийное моделирование. ИМ применяется, когда аналитическое решение невозможно из-за сложности, нелинейности или стохастичности.

### 2. Системная динамика
Подход Форрестера: накопители, потоки и петли обратной связи (усиливающие R, балансирующие B). Макроуровень, агрегированные показатели, непрерывное время. Пример --- модель диффузии Басса.

### 3. Агентное моделирование
Система «снизу вверх»: автономные агенты с локальными правилами порождают ==эмерджентность==. Эпидемиология, социальные системы, рынки.

### 4. Дискретно-событийное моделирование
Время продвигается скачками от события к событию. Основные элементы --- сущности, ресурсы, очереди, процессы. Логистика, производство, сервисные системы.

### 5. Основы теории массового обслуживания
СМО: входящий поток, каналы обслуживания, очередь. ==Пуассоновский поток==: стационарность, ординарность, отсутствие последействия. Марковские процессы, уравнения Колмогорова.

### 6. Теория очередей --- введение
Нотация Кендалла $A/S/m/B/K/SD$. ==Закон Литтла== $E[n] = \lambda \cdot E[r]$. Распределения: M (экспоненциальное), G (общее), D (детерминированное).

### 7. Анализ одиночной очереди
M/M/1, M/M/m, M/M/m/B --- формулы для стационарных характеристик. Формулы Эрланга B и C. Условие устойчивости: $\rho < 1$.

### 8. Сети массового обслуживания
Открытые и замкнутые сети. Теорема Джексона: продуктовая форма стационарного распределения. Каждый узел можно анализировать независимо.

### 9. SimPy --- основы
Библиотека DES на Python (генераторы, yield). Абстракции: Environment, Process, Resource, Container, Store.

### 10. SimPy --- практика
Полные модели: автомойка, кинотеатр. Сбор статистики, анализ чувствительности. Resource, Container, Store.

### 11. Моделирование и анализ
Методология по Law: формулировка, сбор данных, модель, верификация, валидация, эксперименты, анализ. Многократные прогоны, доверительные интервалы, переходный режим.

---

## Ключевые определения

**Имитационная модель**
:   Исполняемая модель системы --- набор правил, по которым из текущего состояния строится следующее. Запуск порождает траекторию поведения во времени.

**Системная динамика**
:   Макроуровень: ==накопители== (stocks), ==потоки== (flows) и петли обратной связи (R --- усиливающие, B --- балансирующие).

**Агентное моделирование (ABM)**
:   Агент --- автономная сущность с локальными правилами; среда --- пространство взаимодействия; ==эмерджентность== --- глобальное поведение из локальных правил.

**Дискретно-событийное моделирование (DES)**
:   Событие --- мгновенное изменение состояния; время продвигается скачками от события к событию.

**Система массового обслуживания (СМО)**
:   Входящий поток заявок + каналы обслуживания + очередь + дисциплина обслуживания.

**Простейший (пуассоновский) поток**
:   Стационарность ($\lambda$ = const), ординарность, отсутствие последействия. Интервалы распределены экспоненциально.

**Марковский процесс**
:   Будущее зависит только от текущего состояния (свойство отсутствия памяти). Непрерывное время --- уравнения Колмогорова.

**Нотация Кендалла $A/S/m/B/K/SD$**
:   $A$ --- распределение приходов, $S$ --- обслуживания, $m$ --- каналы, $B$ --- буфер, $K$ --- источник, $SD$ --- дисциплина.

**Закон Литтла**
:   $E[n] = \lambda \cdot E[r]$. Среднее число заявок = интенсивность $\times$ среднее время пребывания. Любая устойчивая система.

**Продуктовая форма сети**
:   Теорема Джексона: $P(n_1, n_2, \ldots, n_K) = \prod_{i=1}^{K} p_i(n_i)$.

---

## Основные формулы

### Пуассоновский поток

Вероятность $m$ событий за время $\tau$:

$$P_m(\tau) = \frac{(\lambda\tau)^m}{m!}\,e^{-\lambda\tau}$$

Распределение интервалов (экспоненциальное):

$$F(t) = 1 - e^{-\lambda t}, \qquad E[T] = \frac{1}{\lambda}, \qquad D[T] = \frac{1}{\lambda^2}$$

---

### Закон Литтла

| Соотношение | Формула |
|---|---|
| Вся система | $E[n] = \lambda \cdot E[r]$ |
| Только очередь | $E[n_q] = \lambda \cdot E[w]$ |
| Связь времён | $E[r] = E[w] + E[s]$ |

---

### Процессы гибели и размножения

$$p_k = \frac{\lambda_0 \lambda_1 \cdots \lambda_{k-1}}{\mu_1 \mu_2 \cdots \mu_k}\, p_0, \qquad k = 1, 2, \ldots$$

$$p_0 = \left(1 + \sum_{k=1}^{\infty}\frac{\lambda_0 \lambda_1 \cdots \lambda_{k-1}}{\mu_1 \mu_2 \cdots \mu_k}\right)^{-1}$$

---

### Уравнения Колмогорова (стационарные)

$$\sum_{\substack{j \neq k}} q_{jk}\, p_j = \left(\sum_{\substack{j \neq k}} q_{kj}\right) p_k$$

Сумма потоков вероятности **в** состояние $k$ = сумма потоков **из** состояния $k$.

---

### M/M/1

| Характеристика | Формула |
|---|---|
| Загрузка | $\rho = \frac{\lambda}{\mu} < 1$ |
| $p_n$ | $(1 - \rho)\,\rho^n$ |
| $E[n]$ | $\frac{\rho}{1 - \rho}$ |
| $E[n_q]$ | $\frac{\rho^2}{1 - \rho}$ |
| $E[r]$ | $\frac{1/\mu}{1 - \rho}$ |
| $E[w]$ | $\frac{\rho / \mu}{1 - \rho}$ |
| Коэф. использования | $U = \rho$ |

---

### M/M/m

| Характеристика | Формула |
|---|---|
| Загрузка на канал | $\rho = \frac{\lambda}{m\mu} < 1$ |
| Нагрузка | $a = \frac{\lambda}{\mu}$ |
| $p_0$ | $\left[\sum_{k=0}^{m-1}\frac{a^k}{k!} + \frac{a^m}{m!}\cdot\frac{1}{1-\rho}\right]^{-1}$ |
| Эрланг C | $C(m, a) = \frac{\frac{a^m}{m!}\cdot\frac{1}{1-\rho}}{\sum_{k=0}^{m-1}\frac{a^k}{k!} + \frac{a^m}{m!}\cdot\frac{1}{1-\rho}}$ |
| $E[n_q]$ | $C(m,a)\cdot\frac{\rho}{1-\rho}$ |
| $E[w]$ | $\frac{C(m,a)}{m\mu(1-\rho)}$ |

---

### Эрланг B --- $M/M/n/n$ (без очереди)

| Характеристика | Формула |
|---|---|
| Нагрузка | $a = \frac{\lambda}{\mu}$ |
| $p_0$ | $\left(\sum_{k=0}^{n}\frac{a^k}{k!}\right)^{-1}$ |
| $P_{\text{отк}}$ (Эрланг B) | $B(n, a) = \frac{\frac{a^n}{n!}}{\sum_{k=0}^{n}\frac{a^k}{k!}}$ |
| Относит. пропускная способность | $Q = 1 - P_{\text{отк}}$ |
| Абсолют. пропускная способность | $A = \lambda\, Q$ |
| Среднее занятых каналов | $\bar{k} = a\,(1 - P_{\text{отк}})$ |

---

### $M/M/1/m{+}1$ (1 канал, $m$ мест в очереди)

| Характеристика | Формула |
|---|---|
| $\rho$ | $\frac{\lambda}{\mu}$ |
| $p_0$ ($\rho \neq 1$) | $\frac{1 - \rho}{1 - \rho^{m+2}}$ |
| $p_n$ | $\rho^n\, p_0, \quad n = 0, \ldots, m{+}1$ |
| $P_{\text{отк}}$ | $\rho^{m+1}\, p_0$ |
| $E[n]$ | $\frac{\rho}{1-\rho} - \frac{(m+2)\,\rho^{m+2}}{1 - \rho^{m+2}}$ |
| $E[n_q]$ | $E[n] - (1 - p_0)$ |
| $E[r]$ | $\frac{E[n]}{\lambda(1 - P_{\text{отк}})}$ |
| $E[w]$ | $E[r] - \frac{1}{\mu}$ |

---

### Открытая сеть Джексона

Эффективные интенсивности:

$$\Lambda_i = \gamma_i + \sum_{j=1}^{K} \Lambda_j\, r_{ji}, \quad i = 1, \ldots, K$$

Продуктовая форма:

$$P(n_1, n_2, \ldots, n_K) = \prod_{i=1}^{K} p_i(n_i)$$

---

## SimPy --- краткий справочник

```python
import simpy

# === Создание среды ===
env = simpy.Environment()

# === Процесс (генератор) ===
def my_process(env):
    while True:
        print(f"Время: {env.now}")
        yield env.timeout(duration)        # ждать duration единиц времени

env.process(my_process(env))               # запустить процесс

# === Ресурс (Resource) --- каналы обслуживания ===
res = simpy.Resource(env, capacity=N)

def client(env, res):
    with res.request() as req:             # запрос ресурса
        yield req                          # ждать, пока ресурс освободится
        yield env.timeout(service_time)    # обслуживание

# === Ресурс с приоритетом ===
res = simpy.PriorityResource(env, capacity=N)
with res.request(priority=1) as req:       # меньшее число = выше приоритет
    yield req

# === Ресурс с вытеснением ===
res = simpy.PreemptiveResource(env, capacity=N)

# === Контейнер (Container) --- однородный ресурс ===
tank = simpy.Container(env, init=0, capacity=100)
yield tank.put(amount)                     # положить amount единиц
yield tank.get(amount)                     # забрать amount единиц
print(tank.level)                          # текущий уровень

# === Хранилище (Store) --- объекты ===
store = simpy.Store(env, capacity=10)
yield store.put(item)                      # положить объект
item = yield store.get()                   # забрать объект

# === FilterStore --- с фильтрацией ===
fstore = simpy.FilterStore(env, capacity=10)
item = yield fstore.get(lambda x: x.type == "A")

# === Запуск симуляции ===
env.run(until=T)                           # запустить до времени T
```

### Паттерн: генератор заявок + обслуживание

```python
import simpy
import random

def source(env, res, lambd):
    """Генератор заявок (пуассоновский поток)."""
    i = 0
    while True:
        yield env.timeout(random.expovariate(lambd))
        i += 1
        env.process(customer(env, res, f"Клиент-{i}"))

def customer(env, res, name):
    """Процесс обслуживания одной заявки."""
    arrival = env.now
    with res.request() as req:
        yield req
        wait = env.now - arrival
        yield env.timeout(random.expovariate(mu))
    # Заявка обслужена

env = simpy.Environment()
res = simpy.Resource(env, capacity=1)
env.process(source(env, res, lambd=1.0))
env.run(until=1000)
```

---

## Нотация Кендалла --- шпаргалка

Полная форма: **$A / S / m / B / K / SD$**

| Позиция | Обозн. | Смысл | Значения |
|---|---|---|---|
| 1 | $A$ | Распределение приходов | **M**, **D**, **G**, $E_k$ |
| 2 | $S$ | Распределение обслуживания | **M**, **D**, **G**, $E_k$ |
| 3 | $m$ | Число каналов | $1, 2, \ldots$ |
| 4 | $B$ | Ёмкость системы | $m, \ldots, \infty$ (по умолч. $\infty$) |
| 5 | $K$ | Размер источника | $1, \ldots, \infty$ (по умолч. $\infty$) |
| 6 | $SD$ | Дисциплина очереди | **FIFO**, **LIFO**, **SIRO**, **PR** |

!!! tip "Сокращённая запись"
    Если $B = \infty$, $K = \infty$ и $SD = \text{FIFO}$, их опускают. Пример: **M/M/1** = $M/M/1/\infty/\infty/\text{FIFO}$.

### Примеры

| Обозначение | Описание |
|---|---|
| $M/M/1$ | 1 канал, пуассоновский поток, эксп. обслуживание, $\infty$ очередь |
| $M/M/m$ | $m$ каналов, $\infty$ очередь |
| $M/M/m/m$ | $m$ каналов, без очереди (Эрланг B) |
| $M/M/1/K$ | 1 канал, буфер на $K$ мест |
| $M/G/1$ | 1 канал, произвольное обслуживание (Поллачек--Хинчин) |
| $M/D/1$ | 1 канал, детерминированное обслуживание |
| $G/G/m$ | Общий случай --- точных формул нет |

---

## Краткая таблица обозначений

| Символ | Значение |
|---|---|
| $\lambda$ | Интенсивность входящего потока |
| $\mu$ | Интенсивность обслуживания (на 1 канал) |
| $\rho$ | Загрузка ($\lambda / \mu$ или $\lambda / (m\mu)$) |
| $a = \lambda/\mu$ | Предложенная нагрузка (Эрланг) |
| $m$ | Число каналов |
| $p_n$ | Вероятность $n$ заявок в стац. режиме |
| $E[n]$ | Среднее число заявок в системе |
| $E[n_q]$ | Среднее число заявок в очереди |
| $E[r]$ | Среднее время пребывания |
| $E[w]$ | Среднее время ожидания |
| $E[s] = 1/\mu$ | Среднее время обслуживания |
| $Q$ | Относительная пропускная способность |
| $A$ | Абсолютная пропускная способность |
| $P_{\text{отк}}$ | Вероятность отказа |
